
#include <lpmd/simulation.h>
#include <lpmd/potential.h>
#include <lpmd/integrator.h>
#include <lpmd/properties.h>

using namespace lpmd;

class MockIntegrator: public Integrator
{
 public:
   MockIntegrator(): counter(0) { }
   void Advance(Simulation & sim, Potential & pot) { counter++; }

   long int counter;
};

@testsuite Tests de Simulation

@test Inicializacion con numero de atomos
{
 Simulation * simp = GeneralEngine(108, Atom("Cu"));
 Simulation & s = (*simp);
 BasicParticleSet & atoms = s.Atoms();
 @equal atoms.Size(), 108
}
@end

@test GetIntegrator sin integrador activo arroja error
{
 Simulation * simp = GeneralEngine(108, Atom("Cu"));
 Simulation & s = (*simp);
 try
 {
  Integrator & integ = s.Integrator();
  @assert false
 }
 catch (NoIntegrator & e) 
 { 
  @assert true 
 }
}
@end

@test Test de SetIntegrator
{
 Simulation * simp = GeneralEngine(108, Atom("Cu"));
 Simulation & s = (*simp);
 MockIntegrator integ;
 s.SetIntegrator(integ);
 @equal &integ, &(s.Integrator())
}
@end

@test Seteo y calculo de temperatura
{
 Simulation * simp = GeneralEngine(108, Atom("Cu"));
 Simulation & s = (*simp);
 s.SetTemperature(300.0);
 BasicParticleSet & atoms = s.Atoms();
 @approx Temperature(atoms), 300.0, 1.0E-10
 s.SetTemperature(150.0);
 @approx Temperature(atoms), 150.0, 1.0E-10 
}
@end

@test Test de CurrentStep() a cero
{
 Simulation * simp = GeneralEngine(108, Atom("Cu"));
 Simulation & s = (*simp);
 @equal s.CurrentStep(), 0
}
@end

@test Test de DoSteps()
{
 Simulation * simp = GeneralEngine(108, Atom("Cu"));
 Simulation & s = (*simp);
 MockIntegrator integ;
 s.SetIntegrator(integ);
 s.DoSteps(5);
 @equal s.CurrentStep(), 5
 @equal integ.counter, 5
}
@end

